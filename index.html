
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zahi's Bangladesh Tax Calculator - Payroll, Charts & PDF</title>
  <meta name="description" content="Estimate Bangladesh tax incl. foreign income, payroll withholding, employer contributions, payslip generator, charts and printable PDF. Deploy on GitHub Pages." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#071226;--card:#071624;--accent:#7dd3fc;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#041021 0%, #071a2a 100%);color:#e6eef8}
    .container{max-width:1100px;margin:22px auto;padding:18px}
    header{display:flex;align-items:center;gap:14px}
    header h1{margin:0;font-size:20px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 30px rgba(2,6,23,0.6);margin-top:12px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:14px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], select, input[type=number]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .row{display:flex;gap:10px}
    .muted{color:var(--muted);font-size:13px}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#042028;font-weight:700;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.04);font-size:14px;text-align:left}
    .small{font-size:13px}
    .kpi{display:flex;gap:12px;align-items:center}
    .kpi .val{font-size:20px;font-weight:700}
    .slab{background:var(--glass);padding:10px;border-radius:8px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .export{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    canvas{max-width:100%}
    @media (max-width:980px){.grid{grid-template-columns:1fr;}.container{padding:12px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M12 2v20M2 12h20" stroke="#7dd3fc" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <div>
        <h1>Zahi's Bangladesh Tax & Payroll Studio</h1>
        <div class="muted">Tax estimator with employer payroll rules, payslip generator, charts and downloadable PDF. Deploy on GitHub Pages.</div>
      </div>
    </header>

    <div class="card">
      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
        <div style="min-width:320px">
          <label for="incomeType">Primary income input</label>
          <div class="row">
            <select id="incomeType" aria-label="incomeType">
              <option value="annual">Annual (BDT)</option>
              <option value="monthly">Monthly (BDT)</option>
            </select>
            <input id="incomeValue" type="number" min="0" step="0.01" value="600000" aria-label="incomeValue" />
          </div>
        </div>

        <div style="min-width:260px">
          <label>Residency & exemptions</label>
          <div class="row">
            <label class="small"><input id="isResident" type="checkbox" checked /> Resident (worldwide income)</label>
            <label class="small"><input id="isFemale" type="checkbox" /> Female</label>
            <label class="small"><input id="isSenior" type="checkbox" /> Age >= 65</label>
          </div>
        </div>

        <div style="min-width:260px">
          <label>Employment income (for employment deduction)</label>
          <input id="employmentIncome" type="number" value="600000" />
          <div class="muted small" style="margin-top:6px">Employment deduction = min(1/3 of employment income, BDT 500,000).</div>
        </div>
      </div>

      <div style="display:flex;gap:12px;margin-top:12px;align-items:center;flex-wrap:wrap">
        <div style="flex:1;min-width:220px">
          <label>Other deductions (annual)</label>
          <input id="otherDeduction" type="number" value="0" />
        </div>
        <div style="flex:1;min-width:220px">
          <label>Investment amount eligible for rebate (annual)</label>
          <input id="investment" type="number" value="0" />
        </div>
        <div style="min-width:260px">
          <label>Choose tax year rules</label>
          <select id="taxYear">
            <option value="2024-25">FY 2024-25 (default)</option>
            <option value="2025-26">FY 2025-26</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px" class="slab">
        <strong>Foreign income & DTAA-style credit</strong>
        <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap">
          <div style="min-width:220px">
            <label>Foreign-sourced gross income (annual, BDT)</label>
            <input id="foreignIncome" type="number" value="0" />
          </div>
          <div style="min-width:220px">
            <label>Foreign tax paid on that income (annual, BDT)</label>
            <input id="foreignTaxPaid" type="number" value="0" />
          </div>
          <div style="min-width:220px">
            <label><input id="foreignRemitted" type="checkbox" /> Remitted to Bangladesh</label>
            <div class="muted small">Remittance may affect some reliefs historically; here it's informational.</div>
          </div>
        </div>
      </div>

      <div style="margin-top:12px" class="slab">
        <strong>Payroll & employer rules (configurable)</strong>
        <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap">
          <div style="min-width:160px">
            <label>Employer contribution (%)</label>
            <input id="employerPercent" type="number" value="10" />
          </div>
          <div style="min-width:160px">
            <label>Employee contribution (%)</label>
            <input id="employeePercent" type="number" value="0" />
          </div>
          <div style="min-width:220px">
            <label>Other monthly deductions (BDT)</label>
            <input id="otherMonthlyDeduction" type="number" value="0" />
          </div>
          <div style="min-width:220px">
            <label>Employer name (for payslip)</label>
            <input id="employerName" type="text" value="Acme Ltd." />
          </div>
          <div style="min-width:220px">
            <label>Employee name (for payslip)</label>
            <input id="employeeName" type="text" value="John Doe" />
          </div>
        </div>
      </div>

      <div style="display:flex;gap:12px;margin-top:14px;align-items:center;justify-content:space-between;flex-wrap:wrap">
        <div class="kpi">
          <div>
            <div class="muted">Taxable income (annual)</div>
            <div class="val" id="taxableAnnual">—</div>
          </div>
          <div style="margin-left:10px">
            <div class="muted">Effective tax rate</div>
            <div class="val" id="effectiveRate">—</div>
          </div>
        </div>

        <div style="display:flex;gap:8px">
          <button id="calc">Calculate</button>
          <button id="compare" class="export">Compare Years</button>
          <button id="generatePayslip" class="export">Generate Payslip (PDF)</button>
          <button id="csv" class="export">Export CSV</button>
        </div>
      </div>

      <div class="grid" style="margin-top:14px">
        <div>
          <div class="slab">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <strong>Detailed breakdown</strong>
              <div class="muted">Slab-wise tax amounts, foreign credit summary, and payroll table.</div>
            </div>

            <div id="breakdownArea"></div>
          </div>

          <div class="card" style="margin-top:12px;padding:12px">
            <strong>Summary</strong>
            <table>
              <tbody>
                <tr><th>Gross annual income (domestic)</th><td id="grossDomestic">—</td></tr>
                <tr><th>Foreign annual income (included)</th><td id="grossForeign">—</td></tr>
                <tr><th>Total gross annual</th><td id="grossAnnual">—</td></tr>
                <tr><th>Taxable annual income</th><td id="taxableShow">—</td></tr>
                <tr><th>Gross tax (before rebate)</th><td id="grossTax">—</td></tr>
                <tr><th>Foreign tax credit (applied)</th><td id="foreignCreditApplied">—</td></tr>
                <tr><th>Investment rebate (applied)</th><td id="rebateApplied">—</td></tr>
                <tr><th>Net tax payable</th><td id="netTax">—</td></tr>
                <tr><th>Yearly take-home pay</th><td id="takeHomeYearly">—</td></tr>
                <tr><th>Monthly take-home pay</th><td id="takeHomeMonthly">—</td></tr>
              </tbody>
            </table>

            <div style="margin-top:12px">
              <strong>Payroll (monthly breakdown)</strong>
              <table id="payrollTable" style="margin-top:8px"><tbody></tbody></table>
            </div>

            <div style="margin-top:10px">
              <canvas id="taxChart" width="400" height="250"></canvas>
            </div>

            <div class="muted small" style="margin-top:8px">The chart shows composition of monthly gross: tax, employee deductions, employer contributions (visualized), and net pay.</div>
          </div>
        </div>

        <aside class="card">
          <strong>Assumptions & references</strong>
          <ul class="muted small">
            <li>Residents are taxed on worldwide income; non-residents on Bangladesh-source income. The app includes foreign income for residents only (configurable checkbox).</li>
            <li>Foreign tax credit applied in a DTAA spirit: limited to the Bangladesh tax attributable to the foreign income (computed by marginal attribution).</li>
            <li>Payroll rules are configurable. I intentionally left statutory rates editable so you can model EPF, gratuity, or other employer schemes without hardcoding possibly incorrect statutory percentages.</li>
          </ul>

          <div style="margin-top:10px" class="muted small">
            <strong>Sources used while modeling behavior</strong>
            <div>NBR publications, Finance Act summaries and DTAA guidance; professional firm summaries (PwC, KPMG, Deloitte) for interpretation notes. This tool is an estimator; consult official documents for filing.</div>
          </div>

          <div style="margin-top:12px" class="muted small">
            <strong>Deploy</strong>
            <div>Single file — put this index.html at repo root and enable GitHub Pages. To save scenarios, attach a light backend (Node/Express) — see comments inside the code.</div>
          </div>
        </aside>
      </div>
    </div>

    <footer class="muted small">Disclaimer: Estimator only. Check NBR, specific DTAA text and consult a tax professional for filing.</footer>
  </div>

<!-- External libs: Chart.js (for charts) and jsPDF + html2canvas (for PDF generation) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
// ---- Configuration: slabs for tax years ----
const TAX_RULES = {
  '2024-25': {
    exemption: 350000,
    slabs: [
      {amt: 100000, rate: 0.05},
      {amt: 400000, rate: 0.10},
      {amt: 500000, rate: 0.15},
      {amt: 500000, rate: 0.20},
      {amt: 2000000, rate: 0.25},
      {amt: Infinity, rate: 0.30}
    ]
  },
  '2025-26': {
    exemption: 375000,
    slabs: [
      {amt: 300000, rate: 0.10},
      {amt: 400000, rate: 0.15},
      {amt: 500000, rate: 0.20},
      {amt: 2000000, rate: 0.25},
      {amt: Infinity, rate: 0.30}
    ]
  }
}

function fmt(n){return new Intl.NumberFormat('en-BD').format(Number(n.toFixed? n: Number(n)||0));}

function calcTaxSingle(yearKey, grossIncome, opts){
  const rules = TAX_RULES[yearKey];
  const exemption = (opts.isFemale || opts.isSenior) ? (rules.exemption + 50000) : rules.exemption;
  const employmentDeduction = Math.min(opts.employmentIncome/3, 500000);
  let taxable = grossIncome - employmentDeduction - (opts.otherDeduction||0);
  if(taxable < 0) taxable = 0;
  let remaining = Math.max(0, taxable - exemption);
  const slabDetails = [];
  let grossTax = 0;
  for(const slab of rules.slabs){
    if(remaining <= 0) break;
    const take = Math.min(remaining, slab.amt);
    const tax = take * slab.rate;
    slabDetails.push({base: take, rate: slab.rate, tax});
    grossTax += tax;
    remaining -= take;
  }
  const rebateAllow = Math.min(0.03 * grossIncome, 0.15 * (opts.investment||0), 1000000);
  const rebateApplied = Math.max(0, Math.min(grossTax, rebateAllow));
  const netTaxAfterRebate = Math.max(0, grossTax - rebateApplied);
  const effectiveRate = grossIncome? (netTaxAfterRebate / grossIncome) : 0;
  return {
    exemption, employmentDeduction, taxable, slabDetails, grossTax, rebateApplied, netTaxAfterRebate, effectiveRate
  };
}

function calcWithForeign(yearKey, domesticGross, foreignGross, foreignTaxPaid, opts){
  const totalGross = domesticGross + (opts.isResident? foreignGross : 0);
  const baseDomesticCalc = calcTaxSingle(yearKey, domesticGross, opts);
  const baseTotalCalc = calcTaxSingle(yearKey, totalGross, opts);
  const bdTaxAttributableToForeign = Math.max(0, baseTotalCalc.grossTax - baseDomesticCalc.grossTax);
  const foreignCreditApplied = Math.max(0, Math.min(foreignTaxPaid || 0, bdTaxAttributableToForeign));
  const grossTax = baseTotalCalc.grossTax;
  const remainingAfterCredit = Math.max(0, grossTax - foreignCreditApplied);
  const rebateAllow = Math.min(0.03 * totalGross, 0.15 * (opts.investment||0), 1000000);
  const rebateApplied = Math.max(0, Math.min(remainingAfterCredit, rebateAllow));
  const netTax = Math.max(0, remainingAfterCredit - rebateApplied);
  return {
    totalGross, baseDomesticCalc, baseTotalCalc, bdTaxAttributableToForeign, foreignCreditApplied, rebateApplied, netTax
  };
}

// UI wiring
const els = {
  incomeType: document.getElementById('incomeType'),
  incomeValue: document.getElementById('incomeValue'),
  isFemale: document.getElementById('isFemale'),
  isSenior: document.getElementById('isSenior'),
  isResident: document.getElementById('isResident'),
  employmentIncome: document.getElementById('employmentIncome'),
  otherDeduction: document.getElementById('otherDeduction'),
  investment: document.getElementById('investment'),
  taxYear: document.getElementById('taxYear'),
  foreignIncome: document.getElementById('foreignIncome'),
  foreignTaxPaid: document.getElementById('foreignTaxPaid'),
  foreignRemitted: document.getElementById('foreignRemitted'),
  employerPercent: document.getElementById('employerPercent'),
  employeePercent: document.getElementById('employeePercent'),
  otherMonthlyDeduction: document.getElementById('otherMonthlyDeduction'),
  employerName: document.getElementById('employerName'),
  employeeName: document.getElementById('employeeName'),
  calc: document.getElementById('calc'),
  compare: document.getElementById('compare'),
  generatePayslip: document.getElementById('generatePayslip'),
  csv: document.getElementById('csv'),
  breakdownArea: document.getElementById('breakdownArea'),
  grossDomestic: document.getElementById('grossDomestic'),
  grossForeign: document.getElementById('grossForeign'),
  grossAnnual: document.getElementById('grossAnnual'),
  taxableAnnual: document.getElementById('taxableAnnual'),
  taxableShow: document.getElementById('taxableShow'),
  grossTax: document.getElementById('grossTax'),
  foreignCreditApplied: document.getElementById('foreignCreditApplied'),
  rebateApplied: document.getElementById('rebateApplied'),
  netTax: document.getElementById('netTax'),
  takeHomeYearly: document.getElementById('takeHomeYearly'),
  takeHomeMonthly: document.getElementById('takeHomeMonthly'),
  effectiveRate: document.getElementById('effectiveRate'),
  payrollTable: document.getElementById('payrollTable').querySelector('tbody'),
  taxChart: document.getElementById('taxChart')
}

let chartInstance = null;

function gatherInputs(){
  const incomeType = els.incomeType.value;
  let rawIncome = Number(els.incomeValue.value)||0;
  const domesticGross = incomeType === 'monthly' ? rawIncome*12 : rawIncome;
  return {
    taxYear: els.taxYear.value,
    domesticGross,
    isFemale: els.isFemale.checked,
    isSenior: els.isSenior.checked,
    isResident: els.isResident.checked,
    employmentIncome: Number(els.employmentIncome.value)||0,
    otherDeduction: Number(els.otherDeduction.value)||0,
    investment: Number(els.investment.value)||0,
    foreignGross: Number(els.foreignIncome.value)||0,
    foreignTaxPaid: Number(els.foreignTaxPaid.value)||0,
    foreignRemitted: els.foreignRemitted.checked,
    employerPercent: Number(els.employerPercent.value)||0,
    employeePercent: Number(els.employeePercent.value)||0,
    otherMonthlyDeduction: Number(els.otherMonthlyDeduction.value)||0,
    employerName: els.employerName.value || 'Employer',
    employeeName: els.employeeName.value || 'Employee'
  };
}

function renderChart(monthlyGross, monthlyTax, monthlyEmployeeDeduct, employerContribution, monthlyNet){
  const ctx = els.taxChart.getContext('2d');
  const data = {
    labels: ['Tax (monthly)','Employee deductions','Employer contrib (monthly)','Net pay'],
    datasets: [{data:[monthlyTax, monthlyEmployeeDeduct, employerContribution, monthlyNet], tension:0.4}]
  };
  if(chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx, {type:'doughnut', data, options:{plugins:{legend:{position:'bottom'}}}});
}

function renderAll(res, inputs){
  const base = res.baseTotalCalc;
  const lines = [];
  lines.push('<table><thead><tr><th>Slab amount (BDT)</th><th>Rate</th><th>Tax (BDT)</th></tr></thead><tbody>');
  for(const s of base.slabDetails){
    lines.push(`<tr><td>${fmt(s.base)}</td><td>${(s.rate*100).toFixed(2)}%</td><td>${fmt(s.tax)}</td></tr>`);
  }
  lines.push('</tbody></table>');
  lines.push('<div style="margin-top:10px"><strong>Foreign income details</strong>');
  lines.push(`<div class="muted small">Foreign gross included: ${fmt(inputs.foreignGross)} | Foreign tax paid: ${fmt(inputs.foreignTaxPaid)} | Credit applied: ${fmt(res.foreignCreditApplied||0)}</div>`);
  lines.push('</div>');
  els.breakdownArea.innerHTML = lines.join('');

# truncated for brevity - full script continues below
